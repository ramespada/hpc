<h1 id="openacc">OpenACC</h1>

<blockquote>
  <p>Open ACCelerator (<em>OpenACC</em>) es un estandar de programación para computación paralela en aceleradores (principalmente GPUs de NIVDIA).</p>
</blockquote>

<p>Fue diseñado para simplificar la programación con GPUs. Se basa en insertar comentarios especiales para darle instrucciones a los cores de la GPU.</p>

<p>En  fortran las directivas empiezan con <code class="language-plaintext highlighter-rouge">!$acc *directiva* [ *argumentos, ...* ]</code></p>

<p>Ejemplo:</p>

<div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="k">program</span><span class="w"> </span><span class="n">main</span><span class="w">
    </span><span class="kt">integer</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">i</span><span class="w">
    </span><span class="kt">real</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="mf">3.0</span><span class="w">
    </span><span class="kt">real</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">x</span><span class="p">(:),</span><span class="w"> </span><span class="n">y</span><span class="p">(:)</span><span class="w">

    </span><span class="k">allocate</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="w">

    </span><span class="n">x</span><span class="o">=</span><span class="mf">2.0</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mf">1.0</span><span class="w">

    </span><span class="c1">!$acc kernels</span><span class="w">
        </span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w">
    </span><span class="c1">!$acc end kernels</span><span class="w">
  </span><span class="k">end</span><span class="w"> </span><span class="k">program</span><span class="w"> 
</span></code></pre></div></div>
<p>Para obtener recursos para GPU:</p>

<ul>
  <li>Logearse en BU SCC:  <code class="language-plaintext highlighter-rouge">ssh username@scc1.bu.edu</code></li>
  <li>Pedir session interactiva : <code class="language-plaintext highlighter-rouge">qlogin -l gpus=1</code></li>
  <li>Usar el nuevo compilador PGI: <code class="language-plaintext highlighter-rouge">module switch pgi/13.5 pgi/16.5</code></li>
  <li>Obtener información de GPU: ` pgaccelinfo `  y  <code class="language-plaintext highlighter-rouge">nvidia-smi</code></li>
</ul>

<p>Compilar: ` pgf90 -acc -Minfo=accel hola.f90 `</p>

<p>Correr: <code class="language-plaintext highlighter-rouge">./a.out</code></p>

<h3 id="dependencia-de-datos">Dependencia de datos:</h3>

<ul>
  <li>Los loops NO se paralelizan si hay dependencia de datos.</li>
</ul>

<h3 id="iniciar-región-paralela">Iniciar región paralela:</h3>

<p>Ejemplo: <em>SAXPY</em> (Single-precission A X Plus Y)</p>
<div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">!$acc parallel loop</span><span class="w">
  </span><span class="k">do</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="w">
    </span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w">
  </span><span class="k">end</span><span class="w"> </span><span class="k">do</span><span class="w">
</span><span class="c1">!$acc end parallel loop</span><span class="w">
</span></code></pre></div></div>

